<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Upaj</title>

  <!-- CSS  -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.3/jquery.mCustomScrollbar.min.css" rel="stylesheet">
  <script>
    var latlngo = {lat : "", long : ""};
      navigator.geolocation.getCurrentPosition(function(position) {
        // latlngo.lat = position.coords.latitude.toString();
        console.log(position.coords.latitude, position.coords.longitude);
        // latlngo = position.coords.latitude + ' ' + position.coords.longitude;
        
        const Http = new XMLHttpRequest();
        const url='http://dev.virtualearth.net/REST/v1/Locations/'+position.coords.latitude + ',' + position.coords.longitude + '?key=AoTJ0es6QeGwvVw9Fb4LCrAhUtdt6ZeDN-eWENSWR8ddNEWPWQ0pTvsA1HZ1ktJj';
        Http.open("GET", url);
        Http.send();
        result = "";
        flag = 0;
        Http.onreadystatechange=function(){
          result = Http.responseText;
          var obj = JSON.parse(result);
          var address = obj.resourceSets["0"]["resources"]["0"]["address"]["formattedAddress"];
          console.log(address);
          document.getElementById("loc").innerHTML = address;
          const http = new XMLHttpRequest();
          var lat = position.coords.latitude;
          var lon = position.coords.longitude;
          const url_weather = 'http://api.openweathermap.org/data/2.5/weather?lat=' + lat + '&lon=' + lon + '&appid=c4ebee5432d574b968a2332bfa6ab6f4&units=metric';
          http.open("GET", url_weather);
          http.send();
          res = "";
          console.log(url_weather);
          http.onreadystatechange = function(){
            res = http.responseText;
            var ob = JSON.parse(res);
            var temp = ob["main"]["temp"];
            var humidity = ob["main"]["humidity"];
            var condition = ob["weather"]["0"]["description"];
            console.log(condition);
            document.getElementById("temp").innerHTML = temp;
            document.getElementById("humidity").innerHTML = humidity;
            console.log(ob);
            if(flag == 0){
              flag = 1;
              var img = document.createElement("img")
              if(condition.includes("clouds")){
                img.src = "../../static/images/haze.png";
              }
              else{
                img.src = "../../static/images/sunny.png";
              }
              img.style.height = "5vw"
              var src = document.getElementById("image_weather");
              src.appendChild(img);
            }
          }
        }
      });
    
  </script>
  {% load static %}

  <link href="{% static 'css/materialize.css' %}" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link href="{% static 'css/materialize.min.css' %}" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link href="{% static 'css/style.css' %}" type="text/css" rel="stylesheet" media="screen,projection"/>
</head>

<body>
  <nav class="white" role="navigation">
    <div class="nav-wrapper container">
      <a id="logo-container" href="" class="brand-logo">
        <img src="{% static 'images/logo.png' %}" style="height: 9vh; width: auto;">
      </a>
      <ul class="right hide-on-med-and-down">
        <li><a href="#">Navbar Link</a></li>
      </ul>

      <ul id="nav-mobile" class="sidenav">
        <li><a href="#">Navbar Link</a></li>
      </ul>
      <a href="#" data-target="nav-mobile" class="sidenav-trigger"><i class="material-icons">menu</i></a>
    </div>
  </nav>

  <div id="index-banner" class="parallax-container">
    <div class="section no-pad-bot">
      <div class="container">
        <br><br>
        <h1 class="header center teal-text text-lighten-2">Upaj</h1>
        <div class="row center">
          <h5 class="header col s12 light">Your personal farming advisor.</h5>
        </div>
        <div class="row center">
          <button href="" class="trigger btn-large waves-effect waves-light teal lighten-1">Chat Now</button>
        </div>
        <br><br>

      </div>
    </div>
    <div class="parallax"><img src="{% static 'images/back.jpg' %}" alt="Unsplashed background img 1"></div>
  </div>


  <div class="container">
    <div class="section">

      <!--   Icon Section   -->
      <div class="row">
        <div class="col s12 m4">
          <div class="icon-block">
            <h2 class="center brown-text"><img src="{% static 'images/agriculture.jpeg' %}"></h2>
            <h5 class="center">Top Crop Producing States</h5>

            <p class="light"><b><center> Rice - West Bengal<br> Wheat - Uttar Pradesh <br> Cotton - Gujrat <br> Jute - West Bengal <br> Tea - Assam </center></b></p>
          </div>
        </div>

        <div class="col s12 m4">
          <div class="icon-block">
            <h2 class="center brown-text"><img src="{% static 'images/m-cloudy.png' %}" height="120vw"></h2>
            <h5 class="center">Weather Today</h5>

            <p class="light"><b><center>You are at <span id='loc'></span>.<br> Today's temperature is <span id='temp'></span><sup> o</sup>C<br> Humidity: <span id='humidity'></span>% <br></center></b></p>
          </div>
        </div>

        <div class="col s12 m4">
          <div class="icon-block">
            <h2 class="center brown-text"><img src="{% static 'images/msp.png' %}" height="120vw"></h2>
            <h5 class="center">Minimum Support Price</h5>

            <p class="light"><b><center>Wheat - 1735/quintal <br> Rice - 1560/quintal <br> Maize - 1345/quintal <br> Mustard - 4000/quintal</center></b></p>
          </div>
        </div>
      </div>

    </div>
  </div>


  <div class="parallax-container valign-wrapper">
    <div class="section no-pad-bot">
      <div class="container">
        <div class="row center">
          <h5 class="header col s12 light">A modern responsive front-end framework based on Material Design</h5>
        </div>
      </div>
    </div>
    <div class="parallax"><img src="{% static 'images/wheat.png' %}" alt="Unsplashed background img 2"></div>
  </div>

  <footer class="page-footer teal">
    <div class="container">
      <div class="row">
        <div class="col l6 s12">
          <h5 class="white-text">Upaj</h5>
          <p class="grey-text text-lighten-4">A chatbot aimed at making farming easier and bring the next green-tech revolution.</p>


        </div>
        <div class="col l3 s12">
          <h5 class="white-text">Settings</h5>
          <ul>
            <li><a class="white-text" href="#!">Link 1</a></li>
            <li><a class="white-text" href="#!">Link 2</a></li>
            <li><a class="white-text" href="#!">Link 3</a></li>
            <li><a class="white-text" href="#!">Link 4</a></li>
          </ul>
        </div>
        <div class="col l3 s12">
          <h5 class="white-text">Connect</h5>
          <ul>
            <li><a class="white-text" href="#!">Link 1</a></li>
            <li><a class="white-text" href="#!">Link 2</a></li>
            <li><a class="white-text" href="#!">Link 3</a></li>
            <li><a class="white-text" href="#!">Link 4</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="footer-copyright">
      <div class="container">
      Made with <a class="brown-text text-lighten-3" href="http://materializecss.com">Materialize</a>
      </div>
    </div>
  </footer>

  <!-- Slider Chat Pane -->
  <div id="chat-pane">
    <div class="chat">
      <div class="chat-title">
        <h1>Upaj</h1>
        <h2>Here to Help</h2>
        {% csrf_token %}
        <figure class="avatar">
          <img src="chathead.png" /></figure>
      </div>
      <div class="messages">
        <div class="messages-content"></div>
      </div>
      <div class="message-box">
        <textarea type="text" class="message-input" name="message-input" placeholder="Type message..."></textarea>
        <button type="submit" class="message-submit">Send</button>
      </div>
    </div>
  </div>


  <!--  Scripts-->
  <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.3/jquery.mCustomScrollbar.concat.min.js"></script>
  <script type="text/javascript" src = "{% static 'js/jquery.slidereveal.min.js' %}"></script>
  <script type="text/javascript" src = "{% static 'js/materialize.js' %}"></script>
  <script type="text/javascript" src = "{% static 'js/materialize.min.js' %}"></script>
  <script type="text/javascript" src = "{% static 'js/init.js' %}"></script>
</body>
</html>
